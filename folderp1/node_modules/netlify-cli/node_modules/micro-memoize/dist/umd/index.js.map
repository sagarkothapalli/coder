{"version":3,"file":"index.js","sources":["../../../src/CacheEventEmitter.ts","../../../src/maxArgs.ts","../../../src/serialize.ts","../../../src/utils.ts","../../../src/Cache.ts","../../../src/expires.ts","../../../src/stats.ts","../../../src/index.ts"],"sourcesContent":["import type { Cache } from './Cache.js';\nimport type { CacheEventListener, CacheEventType, CacheNode } from './internalTypes.js';\n\ntype ListenerMap<Fn extends (...args: any[]) => any> = Partial<\n  Record<string, Set<CacheEventListener<CacheEventType, Fn>>>\n>;\n\nexport class CacheEventEmitter<Fn extends (...args: any[]) => any> {\n  /**\n   * The list of [l]isteners for the given [t]ype.\n   */\n  l: ListenerMap<Fn> = {};\n\n  /**\n   * The [c]ache the emitter is associated with.\n   */\n  private c: Cache<Fn>;\n\n  constructor(cache: Cache<Fn>) {\n    this.c = cache;\n  }\n\n  /**\n   * Method to [a]dd a listener for the given cache change event.\n   */\n  a<Type extends CacheEventType>(type: Type, listener: CacheEventListener<Type, Fn>): void {\n    const listeners = this.l[type];\n\n    if (!listeners) {\n      this.l[type] = new Set([listener]);\n    } else if (!listeners.has(listener)) {\n      listeners.add(listener);\n    }\n  }\n\n  /**\n   * Method to [n]otify all listeners for the given cache change event.\n   */\n  n(type: CacheEventType, node: CacheNode<Fn>, reason?: string): void {\n    const listeners = this.l[type];\n\n    if (!listeners) {\n      return;\n    }\n\n    listeners.forEach((listener) => {\n      listener({\n        cache: this.c,\n        key: node.k,\n        reason,\n        value: node.v,\n        type,\n      });\n    });\n  }\n\n  /**\n   * Method to [r]emove a listener for the given cache change event.\n   */\n  r<Type extends CacheEventType>(type: Type, listener: CacheEventListener<Type, Fn>): void {\n    const listeners = this.l[type];\n\n    if (!listeners) {\n      return;\n    }\n\n    listeners.delete(listener);\n\n    if (!listeners.size) {\n      this.l[type] = undefined;\n    }\n  }\n}\n","import type { Key, TransformKey } from './internalTypes.js';\n\n/**\n * Create a method that takes the first N number of items from the array (faster than slice).\n */\nexport function getMaxArgsTransformKey<Fn extends (...args: any[]) => any>(\n  maxArgs: number,\n): TransformKey<Fn> | undefined {\n  if (maxArgs === 1) {\n    return (args: Key) => (maxArgs >= args.length ? args : [args[0]]);\n  }\n\n  if (maxArgs === 2) {\n    return (args: Key) => (maxArgs >= args.length ? args : [args[0], args[1]]);\n  }\n\n  return (args: Key) => {\n    if (maxArgs >= args.length) {\n      return args;\n    }\n\n    const clone = new Array(maxArgs);\n\n    for (let index = 0; index < maxArgs; ++index) {\n      clone[index] = args[index];\n    }\n\n    return clone;\n  };\n}\n","import { stringify } from 'fast-stringify';\nimport type { Key } from './internalTypes.js';\n\n/**\n * Default replacer used when stringifying to ensure values that would normally be\n * ignored are respected.\n */\nfunction replacer(_key: string, value: any): any {\n  const type = typeof value;\n\n  return type === 'function' || type === 'symbol' ? value.toString() : value;\n}\n\n/**\n * Default serializer used when `serialize` option set to `true`.\n */\nexport function transformKeySerialized<Fn extends (...args: any[]) => any>(args: Parameters<Fn>): [string] {\n  return [stringify(args, { replacer })];\n}\n\n/**\n * Determines whether the serialized keys are equal to one another.\n */\nexport function isSerializedKeyEqual(prevKey: Key, nextKey: Key): boolean {\n  return prevKey[0] === nextKey[0];\n}\n","import type { Memoized, Options } from './internalTypes.js';\n\n/**\n * Whether the value passed is a memoized function via `micro-memoize`.\n */\nexport function isMemoized<Fn extends (...args: any) => any, Opts extends Options<Fn>>(\n  fn: any,\n): fn is Memoized<Fn, Opts> {\n  return typeof fn === 'function' && fn.isMemoized;\n}\n\n/**\n * Determine whether the value passed is a numeric value for usage in common contexts.\n * This is a positive, finite integer.\n */\nexport function isNumericValueValid(value: any): value is number {\n  return typeof value === 'number' && value >= 0 && Number.isFinite(value);\n}\n","import { deepEqual, shallowEqual } from 'fast-equals';\nimport { CacheEventEmitter } from './CacheEventEmitter.js';\nimport type {\n  CacheEntry,\n  CacheEventType,\n  CacheEventListener,\n  CacheNode,\n  CacheSnapshot,\n  Key,\n  Options,\n  IsKeyEqual,\n  TransformKey,\n} from './internalTypes.js';\nimport { getMaxArgsTransformKey } from './maxArgs.js';\nimport { isSerializedKeyEqual, transformKeySerialized } from './serialize.js';\nimport { isNumericValueValid } from './utils.js';\n\nexport class Cache<Fn extends (...args: any[]) => any> {\n  /**\n   * The current [c]ount of entries in the cache.\n   */\n  c = 0;\n  /**\n   * Whether the entire key is [e]qual to an existing key in cache.\n   */\n  e: IsKeyEqual;\n  /**\n   * The [h]ead of the cache linked list.\n   */\n  h: CacheNode<Fn> | undefined;\n  /**\n   * The transformer for the [k]ey stored in cache.\n   */\n  k: Options<Fn>['transformKey'] | undefined;\n  /**\n   * Event emitter for `[o]`n events.\n   */\n  o: CacheEventEmitter<Fn> | undefined;\n  /**\n   * Whether to await the [p]romise returned by the function.\n   */\n  p: Options<Fn>['async'];\n  /**\n   * The maximum [s]ize of the cache.\n   */\n  s: number;\n  /**\n   * The [t]ail of the cache linked list.\n   */\n  t: CacheNode<Fn> | undefined;\n\n  constructor(options: Options<Fn>) {\n    const { async, maxSize } = options;\n\n    this.e = getIsKeyEqual(options);\n    this.k = getTransformKey(options);\n    this.p = typeof async === 'boolean' && async;\n    this.s = isNumericValueValid(maxSize) ? maxSize : 1;\n  }\n\n  /**\n   * The size of the populated cache.\n   */\n  get size(): number {\n    return this.c;\n  }\n\n  /**\n   * The [key, value] pairs for the existing entries in cache.\n   */\n  get snapshot(): CacheSnapshot<Fn> {\n    const entries: Array<CacheEntry<Fn>> = [];\n    const keys: Key[] = [];\n    const values: Array<ReturnType<Fn>> = [];\n\n    let node = this.h;\n    let size = 0;\n\n    while (node != null) {\n      keys.push(node.k);\n      values.push(node.v);\n      entries.push([node.k, node.v]);\n      ++size;\n\n      node = node.n;\n    }\n\n    return { entries, keys, size, values };\n  }\n\n  /**\n   * Clear the cache.\n   */\n  clear(reason = 'explicit clear'): void {\n    if (!this.h) {\n      return;\n    }\n\n    const emitter = this.o;\n\n    let nodes: Array<CacheNode<Fn>> | undefined;\n\n    if (emitter) {\n      nodes = [];\n\n      let node: CacheNode<Fn> | undefined = this.h;\n\n      while (node != null) {\n        nodes.push(node);\n        node = node.n;\n      }\n    }\n\n    this.h = this.t = undefined;\n    this.c = 0;\n\n    if (emitter && nodes) {\n      for (let index = 0; index < nodes.length; ++index) {\n        emitter.n('delete', nodes[index]!, reason);\n      }\n    }\n  }\n\n  /**\n   * Delete the entry for the key based on the given `args` in cache.\n   */\n  delete(args: Parameters<Fn>, reason = 'explicit delete'): boolean {\n    const node = this.g(this.k ? this.k(args) : args);\n\n    if (node) {\n      this.d(node, reason);\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Get the value in cache based on the given `args`.\n   */\n  get(args: Parameters<Fn>, reason = 'explicit get'): ReturnType<Fn> | undefined {\n    const node = this.g(this.k ? this.k(args) : args);\n\n    if (node) {\n      if (node !== this.h) {\n        this.u(node, reason, true);\n      } else if (this.o) {\n        this.o.n('hit', node, reason);\n      }\n\n      return node.v;\n    }\n  }\n\n  /**\n   * Determine whether the given `args` have a related entry in the cache.\n   */\n  has(args: Parameters<Fn>): boolean {\n    return !!this.g(this.k ? this.k(args) : args);\n  }\n\n  /**\n   * Remove the given `listener` for the given `type` of cache event.\n   */\n  off<Type extends CacheEventType>(type: Type, listener: CacheEventListener<Type, Fn>): void {\n    this.o && this.o.r(type, listener);\n  }\n\n  /**\n   * Add the given `listener` for the given `type` of cache event.\n   */\n  on<Type extends CacheEventType>(type: Type, listener: CacheEventListener<Type, Fn>): void {\n    if (!this.o) {\n      this.o = new CacheEventEmitter<Fn>(this);\n    }\n\n    this.o.a(type, listener);\n  }\n\n  /**\n   * Add or update the cache entry for the given `key`.\n   */\n  set(key: Parameters<Fn>, value: ReturnType<Fn>, reason = 'explicit set'): void {\n    const normalizedKey = this.k ? this.k(key) : key;\n\n    let node = this.g(normalizedKey);\n\n    if (node) {\n      const prevValue = node.v;\n\n      node.v = value;\n\n      if (this.p && value !== prevValue) {\n        node.v = this.w(node);\n      }\n\n      node !== this.h && this.u(node, reason, false);\n    } else {\n      node = this.n(normalizedKey, value);\n    }\n  }\n\n  /**\n   * Method to [d]elete the given `node` from the cache.\n   */\n  d(node: CacheNode<Fn>, reason: string): void {\n    const next = node.n;\n    const prev = node.p;\n\n    if (next) {\n      next.p = prev;\n    } else {\n      this.t = prev;\n    }\n\n    if (prev) {\n      prev.n = next;\n    } else {\n      this.h = next;\n    }\n\n    --this.c;\n\n    node.r = true;\n\n    this.o && this.o.n('delete', node, reason);\n  }\n\n  /**\n   * Method to [g]et an existing node from cache based on the given `key`.\n   */\n  g(key: Key): CacheNode<Fn> | undefined {\n    let node = this.h;\n\n    if (!node || node.r) {\n      return;\n    }\n\n    if (this.e(node.k, key)) {\n      return node;\n    }\n\n    if (this.h === this.t) {\n      return;\n    }\n\n    node = node.n;\n\n    while (node) {\n      if (node.r) {\n        return;\n      }\n\n      if (this.e(node.k, key)) {\n        return node;\n      }\n\n      node = node.n;\n    }\n  }\n\n  /**\n   * Method to create a new [n]ode and set it at the head of the linked list.\n   */\n  n(key: Key, value: ReturnType<Fn>, reason?: string): CacheNode<Fn> {\n    const prevHead = this.h;\n    const prevTail = this.t;\n    const node = { k: key, n: prevHead, p: undefined, v: value };\n\n    if (this.p) {\n      node.v = this.w(node);\n    }\n\n    this.h = node;\n\n    if (prevHead) {\n      prevHead.p = node;\n    } else {\n      this.t = node;\n    }\n\n    if (++this.c > this.s && prevTail) {\n      this.d(prevTail, 'evicted');\n    }\n\n    this.o && this.o.n('add', node, reason);\n\n    return node;\n  }\n\n  /**\n   * Method to [u]date the location of the given `node` in cache.\n   */\n  u(node: CacheNode<Fn>, reason: string | undefined, hit: boolean): void {\n    const next = node.n;\n    const prev = node.p;\n\n    if (next) {\n      next.p = prev;\n    }\n\n    if (prev) {\n      prev.n = next;\n    }\n\n    if (this.h) {\n      this.h.p = node;\n    }\n\n    node.n = this.h;\n    node.p = undefined;\n\n    this.h = node;\n\n    if (node === this.t) {\n      this.t = prev;\n    }\n\n    if (this.o) {\n      hit && this.o.n('hit', node, reason);\n      this.o.n('update', node, reason);\n    }\n  }\n\n  /**\n   * Method to [w]rap the promise in a handler to automatically delete the\n   * entry if it rejects.\n   */\n  w(node: CacheNode<Fn>): ReturnType<Fn> {\n    const { v: value } = node;\n\n    // If the method does not return a promise for some reason, just keep the\n    // original value.\n    if (value == null || typeof value.then !== 'function') {\n      return value;\n    }\n\n    return value.then(\n      (value: any) => {\n        !node.r && this.o && this.o.n('update', node, 'resolved');\n\n        return value;\n      },\n      (error: unknown) => {\n        !node.r && this.d(node, 'rejected');\n\n        throw error;\n      },\n    );\n  }\n}\n\nfunction getIsKeyEqual<Fn extends (...args: any[]) => any>({\n  isKeyEqual,\n  isKeyItemEqual,\n  serialize,\n}: Options<Fn>): IsKeyEqual {\n  if (typeof isKeyEqual === 'function') {\n    return isKeyEqual;\n  }\n\n  if (serialize) {\n    return isSerializedKeyEqual;\n  }\n\n  const isItemEqual =\n    typeof isKeyItemEqual === 'function'\n      ? isKeyItemEqual\n      : isKeyItemEqual === 'deep'\n        ? deepEqual\n        : isKeyItemEqual === 'shallow'\n          ? shallowEqual\n          : Object.is;\n\n  return function isKeyEqual(prevKey: Key, nextKey: Key): boolean {\n    const length = nextKey.length;\n\n    if (prevKey.length !== length) {\n      return false;\n    }\n\n    if (length === 1) {\n      return isItemEqual(prevKey[0], nextKey[0], 0);\n    }\n\n    for (let index = 0; index < length; ++index) {\n      if (!isItemEqual(prevKey[index], nextKey[index], index)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n}\n\n/**\n * Get the `transformKey` option based on the options provided.\n */\nfunction getTransformKey<Fn extends (...args: any[]) => any>(options: Options<Fn>): TransformKey<Fn> | undefined {\n  const { maxArgs, serialize, transformKey } = options;\n\n  const transformers = [\n    serialize ? (typeof serialize === 'function' ? serialize : transformKeySerialized) : undefined,\n    isNumericValueValid(maxArgs) ? getMaxArgsTransformKey(maxArgs) : undefined,\n    typeof transformKey === 'function' ? transformKey : undefined,\n  ].filter(Boolean) as Array<(...args: any[]) => any>;\n\n  return transformers.length\n    ? transformers.reduce(\n        (f, g) =>\n          (...args) =>\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            f(g(...args)),\n      )\n    : undefined;\n}\n","import type { Cache } from './Cache.js';\nimport type {\n  CacheEventListener,\n  GetExpires,\n  Key,\n  Options,\n  ShouldPersist,\n  ShouldRemoveOnExpire,\n} from './internalTypes.js';\nimport { isNumericValueValid } from './utils.js';\n\nexport class ExpirationManager<Fn extends (...args: any[]) => any> {\n  /**\n   * The [c]ache being monitored.\n   */\n  c: Cache<Fn>;\n  /**\n   * Map of [e]xpiration timeouts.\n   */\n  e = new Map<Key, ReturnType<typeof setTimeout>>();\n  /**\n   * Whether the entry in cache should [p]ersist, and therefore not\n   * have any expiration.\n   */\n  p: ShouldPersist<Fn> | undefined;\n  /**\n   * Whether the entry in cache should be [r]emoved on expiration.\n   */\n  r: ShouldRemoveOnExpire<Fn> | undefined;\n  /**\n   * The [t]ime to wait before expiring, or a method that determines that time.\n   */\n  t: number | GetExpires<Fn>;\n  /**\n   * Whether the expiration should [u]pdate when the cache entry is hit.\n   */\n  u: boolean;\n\n  constructor(cache: Cache<Fn>, expires: Required<Options<Fn>>['expires']) {\n    this.c = cache;\n\n    if (typeof expires === 'object') {\n      this.t = expires.after;\n      this.p = expires.shouldPersist;\n      this.r = expires.shouldRemove;\n      this.u = !!expires.update;\n    } else {\n      this.t = expires;\n      this.u = false;\n    }\n\n    this.c.on('add', ({ key, value }) => {\n      this.a(key, value) && this.s(key, value);\n    });\n\n    if (this.u) {\n      // Set up a `hit` listener if we care about updating the expiration.\n      this.c.on('hit', ({ key, value }) => {\n        this.a(key, value) && this.s(key, value);\n      });\n\n      if (this.c.p) {\n        const onResolved: CacheEventListener<'update', Fn> = ({ key, reason, value }) => {\n          if (reason === 'resolved' && this.a(key, value)) {\n            this.s(key, value);\n            // Automatically remove the listener to avoid unnecessary work on updates after\n            // the item is resolved, as that can only ever happen once.\n            this.c.off('update', onResolved);\n          }\n        };\n\n        // If the method is also async, then when the value resolved update the expiration cache.\n        this.c.on('update', onResolved);\n      }\n    }\n\n    this.c.on('delete', ({ key }) => {\n      this.e.has(key) && this.d(key);\n    });\n  }\n\n  get size(): number {\n    return this.e.size;\n  }\n\n  /**\n   * Whether the cache expiration should be set [a]gain, generally after some cache change.\n   */\n  a(key: Key, value: ReturnType<Fn>): boolean {\n    return !!(this.c.g(key) && !this.p?.(key, value, this.c));\n  }\n\n  /**\n   * Method to [d]elete the expiration.\n   */\n  d(key: Key): void {\n    const expiration = this.e.get(key);\n\n    if (expiration) {\n      clearTimeout(expiration);\n      this.e.delete(key);\n    }\n  }\n\n  /**\n   * Method to [s]et the new expiration. If one is present for the given `key`, it will delete\n   * the existing expiration before creating the new one.\n   */\n  s(key: Key, value: ReturnType<Fn>): void {\n    if (this.e.has(key)) {\n      this.d(key);\n    }\n\n    const cache = this.c;\n    const time = typeof this.t === 'function' ? this.t(key, value, cache) : this.t;\n\n    if (!isNumericValueValid(time)) {\n      throw new TypeError(`The expiration time must be a finite, non-negative number; received ${time as string}`);\n    }\n\n    const timeout = setTimeout(() => {\n      this.d(key);\n\n      const node = cache.g(key);\n\n      if (!node) {\n        return;\n      }\n\n      if (typeof this.r === 'function' && !this.r(key, node.v, time, cache)) {\n        if (node !== cache.h) {\n          cache.u(node, 'expiration reset', false);\n        } else if (cache.o) {\n          // Always notify, even if at the top of the cache.\n          cache.o.n('update', node, 'expiration reset');\n        }\n\n        this.s(key, node.v);\n      } else {\n        cache.d(node, 'expired');\n      }\n    }, time);\n\n    if (typeof timeout.unref === 'function') {\n      // If done in NodeJS, the timeout should have its reference removed to avoid\n      // hanging timers if collected while running.\n      timeout.unref();\n    }\n\n    this.e.set(key, timeout);\n  }\n}\n","import { Cache } from './Cache.js';\nimport type { GlobalStats, ProfileStats } from './internalTypes.js';\n\ninterface ProfileCounts {\n  c: number;\n  h: number;\n}\n\nconst nameToProfile = new Map<string, StatsManager<any>>();\n\nlet active = false;\n\nexport class StatsManager<Fn extends (...args: any[]) => any> {\n  /**\n   * The [c]ache listened to when collecting counts.\n   */\n  c: Cache<Fn>;\n  /**\n   * Method to [d]elete existing cache listeners.\n   */\n  d: (() => void) | undefined;\n  /**\n   * The [n]ame of the profile to manage in stats.\n   */\n  n: string;\n  /**\n   * The counts for the stats [p]rofile.\n   */\n  p: ProfileCounts = { c: 0, h: 0 };\n\n  constructor(cache: Cache<Fn>, statsName: string) {\n    this.c = cache;\n    this.n = statsName;\n\n    nameToProfile.set(statsName, this);\n\n    if (active) {\n      this.s();\n    }\n  }\n\n  /**\n   * Method to compute the [m]etrics for the profile stats.\n   */\n  m(): ProfileStats {\n    const { c: calls, h: hits } = this.p;\n    const usage = calls ? `${((hits / calls) * 100).toFixed(4)}%` : '0.0000%';\n\n    return { calls, hits, name: this.n, usage };\n  }\n\n  /**\n   * Method to [r]eset the counts.\n   */\n  r() {\n    this.p = { c: 0, h: 0 };\n  }\n\n  /**\n   * Method to [s]tart the collection of stats for the given profile.\n   */\n  s() {\n    const onAdd = () => {\n      ++this.p.c;\n    };\n    const onHit = () => {\n      ++this.p.c;\n      ++this.p.h;\n    };\n\n    this.d = () => {\n      this.c.off('add', onAdd);\n      this.c.off('hit', onHit);\n\n      this.d = undefined;\n\n      this.p.c = this.p.h = 0;\n    };\n\n    this.c.on('add', onAdd);\n    this.c.on('hit', onHit);\n  }\n}\n\n/**\n * Clear all existing stats stored, either of the specific profile whose name is passed,\n * or globally if no name is passed.\n */\nexport function clearStats(statsName?: string) {\n  if (!active) {\n    return;\n  }\n\n  if (statsName) {\n    const statsManager = nameToProfile.get(statsName);\n\n    if (statsManager) {\n      statsManager.r();\n    }\n  } else {\n    nameToProfile.clear();\n  }\n}\n\n/**\n * Get the stats of a given profile, or global stats if no `statsName` is given.\n */\nexport function getStats<Name extends string | undefined>(\n  statsName?: Name,\n): undefined extends Name ? GlobalStats | undefined : ProfileStats | undefined {\n  if (!active) {\n    console.warn('Stats are not being collected; please run \"startCollectingStats()\" to collect them.');\n    return;\n  }\n\n  if (statsName != null) {\n    const statsManager = nameToProfile.get(statsName);\n\n    const profileStats: ProfileStats = statsManager?.p.c\n      ? statsManager.m()\n      : {\n          calls: 0,\n          hits: 0,\n          name: statsName,\n          usage: getUsagePercentage(0, 0),\n        };\n    // @ts-expect-error - Conditional returns can be tricky.\n    return profileStats;\n  }\n\n  let calls = 0;\n  let hits = 0;\n\n  const profiles: Record<string, ProfileStats> = {};\n\n  nameToProfile.forEach((profile, statsName) => {\n    profiles[statsName] = profile.m();\n\n    calls += profile.p.c;\n    hits += profile.p.h;\n  });\n\n  const globalStats: GlobalStats = {\n    calls,\n    hits,\n    profiles,\n    usage: getUsagePercentage(calls, hits),\n  };\n\n  // @ts-expect-error - Conditional returns can be tricky.\n  return globalStats;\n}\n\n/**\n * Get the usage percentage based on the number of hits and total calls.\n */\nfunction getUsagePercentage(calls: number, hits: number): string {\n  return calls ? `${((hits / calls) * 100).toFixed(4)}%` : '0.0000%';\n}\n\n/**\n * Whether stats are currently being collected.\n */\nexport function isCollectingStats(): boolean {\n  return active;\n}\n\n/**\n * Start collecting stats.\n */\nexport function startCollectingStats(): void {\n  if (!active) {\n    active = true;\n\n    nameToProfile.forEach((profile) => {\n      profile.s();\n    });\n  }\n}\n\n/**\n * Stop collecting stats.\n */\nexport function stopCollectingStats(): void {\n  if (active) {\n    nameToProfile.forEach((profile) => {\n      profile.d?.();\n    });\n\n    active = false;\n  }\n}\n","import { Cache } from './Cache.js';\nimport { ExpirationManager } from './expires.js';\nimport type { Key, Memoize, Memoized, Options } from './internalTypes.js';\nimport { StatsManager } from './stats.js';\nimport { isMemoized } from './utils.js';\n\nexport type * from './internalTypes.js';\n\nexport const memoize: Memoize = function memoize<Fn extends (...args: any[]) => any, Opts extends Options<Fn>>(\n  fn: Fn | Memoized<Fn, Opts>,\n  options: Opts = {} as Opts,\n): Memoized<Fn, Opts> {\n  if (isMemoized(fn)) {\n    return memoize(fn.fn, Object.assign({}, fn.options, options));\n  }\n\n  if (typeof fn !== 'function') {\n    throw new TypeError(`Expected first parameter to be function; received ${typeof fn}`);\n  }\n\n  const cache = new Cache(options);\n  const memoized = createMemoizedMethod<Fn, Opts>(fn, cache, options.forceUpdate);\n\n  const { expires, statsName } = options;\n\n  memoized.cache = cache;\n  memoized.expirationManager = expires != null ? new ExpirationManager(cache, expires) : null;\n  memoized.fn = fn;\n  memoized.isMemoized = true;\n  memoized.options = options;\n  memoized.statsManager = statsName != null ? new StatsManager(cache, statsName) : null;\n\n  return memoized;\n};\n\nfunction createMemoizedMethod<Fn extends (...args: any) => any, Opts extends Options<Fn>>(\n  fn: Fn,\n  cache: Cache<Fn>,\n  forceUpdate: Opts['forceUpdate'],\n): Memoized<Fn, Opts> {\n  const memoized = function memoized(this: any, ...args: Parameters<Fn>): ReturnType<Fn> {\n    const key: Key = cache.k ? cache.k(args) : args;\n\n    let node = cache.g(key);\n\n    if (!node) {\n      node = cache.n(key, fn.apply(this, args) as ReturnType<Fn>);\n    } else if (node !== cache.h) {\n      cache.u(node, undefined, true);\n    } else if (cache.o) {\n      cache.o.n('hit', node);\n    }\n\n    return node.v;\n  } as Memoized<Fn, Opts>;\n\n  if (!forceUpdate) {\n    return memoized;\n  }\n\n  return function wrappedMemoized(this: any, ...args: Parameters<Fn>): ReturnType<Fn> {\n    if (!forceUpdate(args) || !cache.has(args)) {\n      return memoized.apply(this, args);\n    }\n\n    const value: ReturnType<Fn> = fn.apply(this, args);\n\n    cache.set(args, value, 'forced');\n\n    return value;\n  } as Memoized<Fn, Opts>;\n}\n\nexport { clearStats, isCollectingStats, getStats, startCollectingStats, stopCollectingStats } from './stats.js';\n"],"names":["stringify","deepEqual","shallowEqual"],"mappings":"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"}