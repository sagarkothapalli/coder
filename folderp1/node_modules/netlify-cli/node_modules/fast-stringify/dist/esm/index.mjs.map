{"version":3,"file":"index.mjs","sources":["../../../src/index.ts"],"sourcesContent":["interface StabilizerItem {\n  key: string;\n  value: any;\n}\n\ninterface StabilizerOptions {\n  /**\n   * Get the value for a given key.\n   */\n  get: (key: string) => any;\n}\n\nexport type Stabilizer = (\n  a: StabilizerItem,\n  b: StabilizerItem,\n  options: StabilizerOptions,\n) => number;\nexport type Replacer = (key: string, value: any) => any;\nexport type CircularReplacer = (\n  key: string,\n  value: any,\n  referenceKey: string,\n) => any;\n\ninterface BaseOptions {\n  /**\n   * Custom replacer function for circular reference values.\n   *\n   * If not provided, circular references are replaced with `[ref=##]` where `##` is a\n   * dot-separated path to the original reference (e.g. `[ref=.nested.obj]`).\n   */\n  circularReplacer?: CircularReplacer;\n  /**\n   * Number of spaces to use as white space for indenting.\n   */\n  indent?: number;\n  /**\n   * Custom replacer function for standard values.\n   */\n  replacer?: Replacer;\n  /**\n   * If true, stable key ordering is used.\n   */\n  stable?: boolean;\n  /**\n   * Custom stabilizer function for stable key ordering when the `stable` option is set to `true`.\n   *\n   * If not provided, keys are sorted in ascending order using `String.prototype.localeCompare`.\n   */\n  stabilizer?: Stabilizer;\n}\n\ninterface SimpleOptions extends BaseOptions {\n  stable?: never;\n  stabilizer?: never;\n}\n\ninterface UnstableOptions extends BaseOptions {\n  stable: false;\n  stabilizer?: never;\n}\n\ninterface StableOptions extends BaseOptions {\n  stable: true;\n  stabilizer?: Stabilizer;\n}\n\nexport type Options = SimpleOptions | StableOptions | UnstableOptions;\n\n/**\n * Consistent reference for no options passed, to avoid garbage.\n */\nconst DEFAULT_OPTIONS: Options = {};\n\n/**\n * Stringifier that handles circular values.\n */\nexport function stringify<Value>(\n  value: Value,\n  {\n    indent,\n    replacer,\n    circularReplacer,\n    stable,\n    stabilizer,\n  }: Options = DEFAULT_OPTIONS,\n): string {\n  const cache: any[] = [];\n  const keys: string[] = [];\n  const getStableSorter =\n    stable && stabilizer\n      ? (object: any) => {\n          const options = {\n            get: (key: string) => object[key],\n          };\n\n          return (a: string, b: string) =>\n            stabilizer(\n              { key: a, value: object[a] },\n              { key: b, value: object[b] },\n              options,\n            );\n        }\n      : undefined;\n\n  return JSON.stringify(\n    value,\n    function replace(this: any, key: string, rawValue: any) {\n      let value = rawValue;\n\n      if (typeof value === 'object' && value !== null) {\n        if (cache.length) {\n          const thisCutoff = cache.indexOf(this) + 1;\n\n          if (thisCutoff === 0) {\n            cache[cache.length] = this;\n          } else {\n            cache.splice(thisCutoff);\n            keys.splice(thisCutoff);\n          }\n\n          keys[keys.length] = key;\n\n          const valueCutoff = cache.indexOf(value) + 1;\n\n          if (valueCutoff > 0) {\n            const referenceKey = keys.slice(0, valueCutoff).join('.') || '.';\n\n            return circularReplacer\n              ? circularReplacer.call(this, key, value, referenceKey)\n              : '[ref=' + referenceKey + ']';\n          }\n        } else {\n          cache[0] = value;\n          keys[0] = key;\n        }\n\n        if (stable && !Array.isArray(value)) {\n          value = Object.keys(value)\n            .sort(getStableSorter?.(value))\n            .reduce<Record<string, any>>((sorted, key) => {\n              sorted[key] = value[key];\n\n              return sorted;\n            }, {});\n        }\n      }\n\n      return replacer ? replacer.call(this, key, value) : value;\n    },\n    indent,\n  );\n}\n"],"names":[],"mappings":"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"}