{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import Subject from'./Subject';import AddSubjectForm from'./AddSubjectForm';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AttendanceTracker=_ref=>{let{onLogout}=_ref;const[subjects,setSubjects]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const token=localStorage.getItem('token');const fetchSubjects=useCallback(async()=>{setLoading(true);setError(null);try{const response=await fetch('/api/subjects',{headers:{'Authorization':\"Bearer \".concat(token)}});const data=await response.json();if(response.ok){setSubjects(data);}else{setError(data.message+(data.error?\": \".concat(data.error):''));if(response.status===401){// Token expired or invalid\nonLogout();}}}catch(err){setError('Network error or server unreachable.');console.error(\"Fetch subjects error:\",err);}finally{setLoading(false);}},[token,onLogout]);useEffect(()=>{if(token){fetchSubjects();}},[token,fetchSubjects]);const addSubject=async subject=>{try{const response=await fetch('/api/subjects',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(subject)});const data=await response.json();if(response.ok){setSubjects(prevSubjects=>[...prevSubjects,data]);}else{setError(data.message||'Failed to add subject');if(response.status===401){onLogout();}}}catch(err){setError('Network error or server unreachable.');console.error(\"Add subject error:\",err);}};const updateSubject=async updatedSubject=>{try{const response=await fetch(\"/api/subjects/\".concat(updatedSubject.id),{method:'PUT',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(updatedSubject)});const data=await response.json();if(response.ok){setSubjects(prevSubjects=>prevSubjects.map(subject=>subject.id===updatedSubject.id?data:subject));}else{setError(data.message||'Failed to update subject');if(response.status===401){onLogout();}}}catch(err){setError('Network error or server unreachable.');console.error(\"Update subject error:\",err);}};const deleteSubject=async subjectId=>{try{const response=await fetch(\"/api/subjects/\".concat(subjectId),{method:'DELETE',headers:{'Authorization':\"Bearer \".concat(token)}});if(response.ok){setSubjects(prevSubjects=>prevSubjects.filter(subject=>subject.id!==subjectId));}else{const data=await response.json();setError(data.message||'Failed to delete subject');if(response.status===401){onLogout();}}}catch(err){setError('Network error or server unreachable.');console.error(\"Delete subject error:\",err);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"attendance-tracker\",children:\"Loading subjects...\"});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-tracker error\",children:[\"Error: \",error]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"attendance-tracker\",children:[/*#__PURE__*/_jsxs(\"header\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Attendance Tracker\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onLogout,children:\"Logout\"})]}),/*#__PURE__*/_jsx(AddSubjectForm,{onAddSubject:addSubject}),/*#__PURE__*/_jsx(\"div\",{className:\"subjects-list\",children:subjects.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No subjects added yet. Add your first subject above!\"}):subjects.map(subject=>/*#__PURE__*/_jsx(Subject,{subject:subject,onUpdate:updateSubject,onDelete:deleteSubject},subject.id))})]});};export default AttendanceTracker;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Subject","AddSubjectForm","jsx","_jsx","jsxs","_jsxs","AttendanceTracker","_ref","onLogout","subjects","setSubjects","loading","setLoading","error","setError","token","localStorage","getItem","fetchSubjects","response","fetch","headers","concat","data","json","ok","message","status","err","console","addSubject","subject","method","body","JSON","stringify","prevSubjects","updateSubject","updatedSubject","id","map","deleteSubject","subjectId","filter","className","children","onClick","onAddSubject","length","onUpdate","onDelete"],"sources":["/Users/anandsagar/coffeproject/attendance-tracker/src/components/AttendanceTracker.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport Subject from './Subject';\nimport AddSubjectForm from './AddSubjectForm';\n\nconst AttendanceTracker = ({ onLogout }) => {\n  const [subjects, setSubjects] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  const token = localStorage.getItem('token');\n\n  const fetchSubjects = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await fetch('/api/subjects', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      const data = await response.json();\n      if (response.ok) {\n        setSubjects(data);\n      } else {\n        setError(data.message + (data.error ? `: ${data.error}` : ''));\n        if (response.status === 401) { // Token expired or invalid\n          onLogout();\n        }\n      }\n    } catch (err) {\n      setError('Network error or server unreachable.');\n      console.error(\"Fetch subjects error:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [token, onLogout]);\n\n  useEffect(() => {\n    if (token) {\n      fetchSubjects();\n    }\n  }, [token, fetchSubjects]);\n\n  const addSubject = async (subject) => {\n    try {\n      const response = await fetch('/api/subjects', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify(subject),\n      });\n      const data = await response.json();\n      if (response.ok) {\n        setSubjects((prevSubjects) => [...prevSubjects, data]);\n      } else {\n        setError(data.message || 'Failed to add subject');\n        if (response.status === 401) {\n          onLogout();\n        }\n      }\n    } catch (err) {\n      setError('Network error or server unreachable.');\n      console.error(\"Add subject error:\", err);\n    }\n  };\n\n  const updateSubject = async (updatedSubject) => {\n    try {\n      const response = await fetch(`/api/subjects/${updatedSubject.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify(updatedSubject),\n      });\n      const data = await response.json();\n      if (response.ok) {\n        setSubjects((prevSubjects) =>\n          prevSubjects.map((subject) =>\n            subject.id === updatedSubject.id ? data : subject\n          )\n        );\n      } else {\n        setError(data.message || 'Failed to update subject');\n        if (response.status === 401) {\n          onLogout();\n        }\n      }\n    } catch (err) {\n      setError('Network error or server unreachable.');\n      console.error(\"Update subject error:\", err);\n    }\n  };\n\n  const deleteSubject = async (subjectId) => {\n    try {\n      const response = await fetch(`/api/subjects/${subjectId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      if (response.ok) {\n        setSubjects((prevSubjects) => prevSubjects.filter((subject) => subject.id !== subjectId));\n      } else {\n        const data = await response.json();\n        setError(data.message || 'Failed to delete subject');\n        if (response.status === 401) {\n          onLogout();\n        }\n      }\n    } catch (err) {\n      setError('Network error or server unreachable.');\n      console.error(\"Delete subject error:\", err);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"attendance-tracker\">Loading subjects...</div>;\n  }\n\n  if (error) {\n    return <div className=\"attendance-tracker error\">Error: {error}</div>;\n  }\n\n  return (\n    <div className=\"attendance-tracker\">\n      <header>\n        <h2>Attendance Tracker</h2>\n        <button onClick={onLogout}>Logout</button>\n      </header>\n      <AddSubjectForm onAddSubject={addSubject} />\n      <div className=\"subjects-list\">\n        {subjects.length === 0 ? (\n          <p>No subjects added yet. Add your first subject above!</p>\n        ) : (\n          subjects.map((subject) => (\n            <Subject\n              key={subject.id}\n              subject={subject}\n              onUpdate={updateSubject}\n              onDelete={deleteSubject}\n            />\n          ))\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AttendanceTracker;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}